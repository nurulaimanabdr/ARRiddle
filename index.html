<!DOCTYPE html>
<html>
  <head>
    <title>AR Riddle Game</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: sans-serif;
      }
      #scoreDisplay {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        color: white;
        font-size: 20px;
        background: rgba(0, 0, 0, 0.5);
        padding: 10px 20px;
        border-radius: 10px;
      }
      #arjsDebugUIContainer {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div id="scoreDisplay">Score: 0</div>
    <a-scene embedded arjs>
      <!-- Marker -->
      <a-marker preset="hiro">
        <a-entity id="riddleContainer" position="0 0.5 0">
          <a-text
            id="riddleText"
            value="Loading..."
            color="#FFFFFF"
            align="center"
            width="2.5"
            position="0 0.6 0"
          ></a-text>

          <!-- Answer Options -->
          <a-box
            id="option1"
            class="clickable"
            position="-0.8 0 0"
            depth="0.1"
            height="0.3"
            width="0.7"
            color="#AAAAAA"
          ></a-box>
          <a-text
            id="text1"
            value=""
            color="#FFFFFF"
            align="center"
            position="-0.8 0 0.1"
          ></a-text>

          <a-box
            id="option2"
            class="clickable"
            position="0 0 0"
            depth="0.1"
            height="0.3"
            width="0.7"
            color="#AAAAAA"
          ></a-box>
          <a-text
            id="text2"
            value=""
            color="#000000"
            align="center"
            position="0 0 0.1"
          ></a-text>

          <a-box
            id="option3"
            class="clickable"
            position="0.8 0 0"
            depth="0.1"
            height="0.3"
            width="0.7"
            color="#AAAAAA"
          ></a-box>
          <a-text
            id="text3"
            value=""
            color="#FFFFFF"
            align="center"
            position="0.8 0 0.1"
          ></a-text>
        </a-entity>
      </a-marker>

      <!-- Camera with Cursor -->
      <a-entity camera>
        <a-cursor
          fuse="true"
          fuse-timeout="700"
          raycaster="objects: .clickable"
          material="color: yellow; shader: flat"
        ></a-cursor>
      </a-entity>
    </a-scene>

    <audio
      id="correctSound"
      src="https://cdn.pixabay.com/audio/2022/03/15/audio_ebfccdff5b.mp3"
    ></audio>
    <audio
      id="wrongSound"
      src="https://cdn.pixabay.com/audio/2022/03/15/audio_f0d82c871d.mp3"
    ></audio>

    <script>
      const riddles = [
        {
          question: "What does CPU stand for?",
          answers: [
            "Central Processing Unit",
            "Computer Personal Unit",
            "Central Print Unit"
          ],
          correct: 0,
        },
        {
          question: "What is the main purpose of RAM in a computer?",
          answers: [
            "Permanent storage",
            "Temporary data storage",
            "Graphic processing"
          ],
          correct: 1,
        },
        {
          question: "Which device is used to input text into a computer?",
          answers: [
            "Monitor",
            "Keyboard",
            "Printer"
          ],
          correct: 1,
        },
        {
          question: "What does HTTP stand for?",
          answers: [
            "HyperText Transfer Protocol",
            "HyperText Transmission Program",
            "Hyper Transfer Text Protocol"
          ],
          correct: 0,
        },
        {
          question: "Which of these is an example of an Operating System?",
          answers: [
            "Windows",
            "HTML",
            "Google"
          ],
          correct: 0,
        },
        {
          question: "What is the function of a hard drive?",
          answers: [
            "Process data",
            "Store data permanently",
            "Display data"
          ],
          correct: 1,
        },
        {
          question: "Which language is primarily used to style web pages?",
          answers: [
            "HTML",
            "CSS",
            "Python"
          ],
          correct: 1,
        },
        {
          question: "What does USB stand for?",
          answers: [
            "Universal Serial Bus",
            "Unique System Backup",
            "Unified Service Board"
          ],
          correct: 0,
        },
        {
          question: "Which part of the computer executes instructions?",
          answers: [
            "CPU",
            "RAM",
            "GPU"
          ],
          correct: 0,
        },
        {
          question: "What is an IP address used for?",
          answers: [
            "Identifying a device on a network",
            "Designing web pages",
            "Running software"
          ],
          correct: 0,
        }
      ];

      let score = 0;
      let current = 0;
      let finished = false;

      const riddleText = document.getElementById("riddleText");
      const optionBoxes = ["option1", "option2", "option3"].map((id) =>
        document.getElementById(id)
      );
      const optionTexts = ["text1", "text2", "text3"].map((id) =>
        document.getElementById(id)
      );
      const scoreDisplay = document.getElementById("scoreDisplay");
      const correctSound = document.getElementById("correctSound");
      const wrongSound = document.getElementById("wrongSound");

      function shuffleRiddles() {
        for (let i = riddles.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [riddles[i], riddles[j]] = [riddles[j], riddles[i]];
        }
      }

      function loadRiddle(index) {
        const r = riddles[index];
        riddleText.setAttribute("value", r.question);
        r.answers.forEach((text, i) => {
          optionTexts[i].setAttribute("value", text);
          optionBoxes[i].setAttribute("color", "#AAAAAA");
          optionBoxes[i].classList.add("clickable");
        });
      }

      function handleAnswer(index) {
        if (finished) return; // Prevent further input when finished

        const correct = riddles[current].correct;
        if (index === correct) {
          score++;
          if (correctSound) correctSound.play();
          optionBoxes[index].setAttribute("color", "#00FF00");
        } else {
          if (wrongSound) wrongSound.play();
          optionBoxes[index].setAttribute("color", "#FF0000");
        }

        scoreDisplay.textContent = "Score: " + score;

        // Remove clickable to prevent further selection until next question/finish
        optionBoxes.forEach(box => {
          box.classList.remove("clickable");
        });

        setTimeout(() => {
          current++;
          if (current < riddles.length) {
            loadRiddle(current);
          } else {
            // Game over!
            riddleText.setAttribute(
              "value",
              `You Win!\nFinal Score: ${score} / ${riddles.length}`
            );
            optionTexts.forEach((txt) => txt.setAttribute("value", ""));
            optionBoxes.forEach(box => {
              box.setAttribute("color", "#CCCCCC");
              box.classList.remove("clickable");
            });
            scoreDisplay.textContent = "Final Score: " + score + " / " + riddles.length;
            finished = true;
          }
        }, 1500);
      }

      optionBoxes.forEach((box, i) => {
        box.addEventListener("click", () => handleAnswer(i));
      });

      shuffleRiddles();
      loadRiddle(current);
    </script>
  </body>
</html>
